>From ffc788c6f841f1dea9cbba761e0a15c6080747da Mon Sep 17 00:00:00 2001
Message-Id: <ffc788c6f841f1dea9cbba761e0a15c6080747da.1567901440.git.crobinso@redhat.com>
From: Cole Robinson <crobinso@redhat.com>
Date: Sat, 7 Sep 2019 17:10:54 -0400
Subject: [PATCH 1/3] rootfs: allow using systemd units from AGENT_SOURCE_BIN
 dirname

Signed-off-by: Cole Robinson <crobinso@redhat.com>
---
 rootfs-builder/rootfs.sh | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/rootfs-builder/rootfs.sh b/rootfs-builder/rootfs.sh
index 0b68764..4bdc10d 100755
--- a/rootfs-builder/rootfs.sh
+++ b/rootfs-builder/rootfs.sh
@@ -497,7 +497,13 @@ EOT
 		make install DESTDIR="${ROOTFS_DIR}" INIT=${AGENT_INIT} SECCOMP=${SECCOMP}
 		popd
 	else
+		AGENT_SOURCE_DIR=$(dirname "${AGENT_SOURCE_BIN}")
+		ROOTFS_SYSTEMD_DIR="${ROOTFS_DIR}"/usr/lib/systemd/system
+		mkdir -p "${AGENT_DIR}"
+		mkdir -p "${ROOTFS_SYSTEMD_DIR}"
 		cp ${AGENT_SOURCE_BIN} ${AGENT_DEST}
+		cp "${AGENT_SOURCE_DIR}"/kata-agent.service "${ROOTFS_SYSTEMD_DIR}"
+		cp "${AGENT_SOURCE_DIR}"/kata-containers.target "${ROOTFS_SYSTEMD_DIR}"
 		OK "cp ${AGENT_SOURCE_BIN} ${AGENT_DEST}"
 	fi
 
-- 
2.21.0

